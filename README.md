# Планировщик спортивного мероприятия

Веб-интерфейс и API-адаптер для формирования расписания соревновательного дня на основе исходных данных.

## Требования

- Python 3.10+
- Node.js 18+

## Установка и запуск

### 1. Установка зависимостей Python

```bash
python3 -m venv .venv
source .venv/bin/activate  # Windows: .\.venv\Scripts\Activate.ps1
pip install fastapi uvicorn pydantic python-multipart pandas openpyxl
```

### 2. Запуск API-сервера

```bash
uvicorn api_adapter:app --reload --port 8000
```

Проверка: `curl http://127.0.0.1:8000/health`

### 3. Запуск фронтенда

```bash
cd planner/frontend
npm install
npm run dev
```

Откройте `http://localhost:5173` в браузере.

## Использование

1. Запустите API-сервер и фронтенд (см. выше)
2. На вкладке «Загрузка данных» загрузите файл `.xlsx` или `.csv`
3. На вкладке «Параметры» укажите:
   - дату соревновательного дня
   - временное окно (начало и окончание)
   - длительность слота
   - список площадок и групп
4. Нажмите «Сформировать расписание»
5. На вкладке «Расписание» просмотрите результат

## Формат входных данных

Excel-файл должен содержать следующие листы:

- **Упражнения**: `Название`, `Длительность` (минуты)
- **Этапы**: `МаксимумУчастников`
- **Корты**: `Корт`, `Открытие`, `Закрытие` (время)
- **Группы**: `ИмяГруппы`, `КоличествоУчастников`, `Упражнение`, `МинимальноеВремяНачала` (опционально), `МаксимальноеВремяОкончания` (опционально)

## API

### Эндпоинты

- `POST /upload` — загрузка файла
- `POST /schedule/plan` — формирование расписания
- `GET /schedule/{plan_id}` — получение расписания по ID
- `GET /health` — проверка работоспособности

### Формат запроса на формирование расписания

```json
{
  "window": {
    "date": "2024-01-01",
    "startTime": "09:00",
    "endTime": "18:00"
  },
  "courts": [
    {"id": "c1", "name": "Зал 1"}
  ],
  "groups": [
    {"id": "g1", "name": "Группа 1", "size": 10, "tags": []}
  ],
  "slotMinutes": 15,
  "parallelLimit": 2,
  "constraints": [],
  "options": {}
}
```

## Интеграция с planner.py

Адаптер автоматически пытается:
1. Импортировать функцию `generate_schedule` из `planner.py` и вызвать её
2. Если импорт не удался, запустить `planner.py` как процесс и передать данные через stdin

Путь к загруженному файлу передаётся в `params.options.lastUploadPath`.

## Сборка фронтенда

```bash
cd planner/frontend
npm run build
```

Результат в `planner/frontend/dist`.
